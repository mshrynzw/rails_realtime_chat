<div id="messages">
  <% @messages.each do |message| %>
    <p><%= message['content'] %></p>
  <% end %>
</div>

<%= form_with(url: messages_path, local: false) do |f| %>
  <%= f.text_field :content %>
  <%= f.submit 'Send' %>
<% end %>

<script>
    const supabase = supabase.createClient('<%= ENV['SUPABASE_URL'] %>', '<%= ENV['SUPABASE_ANON_KEY'] %>')

    supabase
        .channel('public:messages')
        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, (payload) => {
            const messageDiv = document.getElementById('messages')
            const newMessage = document.createElement('p')
            newMessage.textContent = payload.new.content
            messageDiv.appendChild(newMessage)
        })
        .subscribe()
</script>